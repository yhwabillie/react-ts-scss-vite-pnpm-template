/* Button.module.scss */
@use 'sass:map';
@use '../../../../styles/mixins' as *;

// Button Colors (웹접근성 기준, 명도 대비 ≥ 4.5:1)
$btn-colors: (
  primary: (
    solid: (
      bg: var(--primary-bg-color-btn-solid),
      label: var(--primary-text-color-btn-solid),
      hover: (
        bg: var(--primary-hover-bg-color-btn-solid),
        label: var(--primary-hover-text-color-btn-solid),
      ),
      active: (
        bg: var(--primary-active-bg-color-btn-solid),
        label: var(--primary-active-text-color-btn-solid),
      ),
      disabled: (
        bg: var(--disabled-bg-color-btn),
        label: var(--disabled-text-color-btn),
      ),
    ),

    //
    outline: (
        bg: var(--bg-color-btn-outline),
        label: var(--primary-text-color-btn-outline),
        hover: (
          bg: var(--primary-hover-bg-color-btn-outline),
          label: var(--primary-hover-text-color-btn-outline),
        ),
        active: (
          bg: var(--primary-active-bg-color-btn-outline),
          label: var(--primary-active-text-color-btn-outline),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    //
    ghost: (
        bg: var(--primary-bg-color-btn-ghost),
        label: var(--primary-text-color-btn-ghost),
        hover: (
          bg: var(--primary-hover-bg-color-btn-ghost),
          label: var(--primary-hover-text-color-btn-ghost),
        ),
        active: (
          bg: var(--primary-active-bg-color-btn-ghost),
          label: var(--primary-active-text-color-btn-ghost),
        ),
        disabled: (
          bg: var(--ghost-disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),
    link: (
      bg: transparent,
      label: #0052cc,
      hover: (
        bg: rgba(0, 82, 204, 0.1),
        label: #003d99,
      ),
      active: (
        bg: rgba(0, 82, 204, 0.2),
        label: #002966,
      ),
      disabled: (
        bg: transparent,
        label: #9e9e9e,
      ),
    ),
  ),

  secondary: (
    solid: (
      bg: var(--secondary-bg-color-btn-solid),
      label: var(--secondary-text-color-btn-solid),
      hover: (
        bg: var(--secondary-hover-bg-color-btn-solid),
        label: var(--secondary-hover-text-color-btn-solid),
      ),
      active: (
        bg: var(--secondary-active-bg-color-btn-solid),
        label: var(--secondary-active-text-color-btn-solid),
      ),
      disabled: (
        bg: var(--disabled-bg-color-btn),
        label: var(--disabled-text-color-btn),
      ),
    ),

    //
    outline: (
        bg: var(--bg-color-btn-outline),
        label: var(--secondary-text-color-btn-outline),
        hover: (
          bg: var(--secondary-hover-bg-color-btn-outline),
          label: var(--secondary-hover-text-color-btn-outline),
        ),
        active: (
          bg: var(--secondary-active-bg-color-btn-outline),
          label: var(--secondary-active-text-color-btn-outline),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    //
    ghost: (
        bg: var(--secondary-bg-color-btn-ghost),
        label: var(--secondary-text-color-btn-ghost),
        hover: (
          bg: var(--secondary-hover-bg-color-btn-ghost),
          label: var(--secondary-hover-text-color-btn-ghost),
        ),
        active: (
          bg: var(--secondary-active-bg-color-btn-ghost),
          label: var(--secondary-active-text-color-btn-ghost),
        ),
        disabled: (
          bg: var(--ghost-disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),
    link: (
      bg: transparent,
      label: #69b2ff,
      hover: (
        bg: rgba(105, 178, 255, 0.1),
        label: #69b2ff,
      ),
      active: (
        bg: rgba(105, 178, 255, 0.2),
        label: #69b2ff,
      ),
      disabled: (
        bg: transparent,
        label: #9e9e9e,
      ),
    ),
  ),

  tertiary: (
    solid: (
      bg: var(--tertiary-bg-color-btn-solid),
      label: var(--tertiary-text-color-btn-solid),
      hover: (
        bg: var(--tertiary-hover-bg-color-btn-solid),
        label: var(--tertiary-hover-text-color-btn-solid),
      ),
      active: (
        bg: var(--tertiary-active-bg-color-btn-solid),
        label: var(--tertiary-active-text-color-btn-solid),
      ),
      disabled: (
        bg: var(--disabled-bg-color-btn),
        label: var(--disabled-text-color-btn),
      ),
    ),

    //
    outline: (
        bg: var(--bg-color-btn-outline),
        label: var(--tertiary-text-color-btn-outline),
        hover: (
          bg: var(--tertiary-hover-bg-color-btn-outline),
          label: var(--tertiary-hover-text-color-btn-outline),
        ),
        active: (
          bg: var(--tertiary-active-bg-color-btn-outline),
          label: var(--tertiary-active-text-color-btn-outline),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    //
    ghost: (
        bg: var(--tertiary-bg-color-btn-ghost),
        label: var(--tertiary-text-color-btn-ghost),
        hover: (
          bg: var(--tertiary-hover-bg-color-btn-ghost),
          label: var(--tertiary-hover-text-color-btn-ghost),
        ),
        active: (
          bg: var(--tertiary-active-bg-color-btn-ghost),
          label: var(--tertiary-active-text-color-btn-ghost),
        ),
        disabled: (
          bg: var(--ghost-disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),
    link: (
      bg: transparent,
      label: #333333,
      hover: (
        bg: rgba(51, 51, 51, 0.1),
        label: #1a1a1a,
      ),
      active: (
        bg: rgba(51, 51, 51, 0.2),
        label: #000000,
      ),
      disabled: (
        bg: transparent,
        label: #9e9e9e,
      ),
    ),
  ),

  success: (
    solid: (
      bg: var(--success-bg-color-btn-solid),
      label: var(--success-text-color-btn-solid),
      hover: (
        bg: var(--success-hover-bg-color-btn-solid),
        label: var(--success-hover-text-color-btn-solid),
      ),
      active: (
        bg: var(--success-active-bg-color-btn-solid),
        label: var(--success-active-text-color-btn-solid),
      ),
      disabled: (
        bg: var(--disabled-bg-color-btn),
        label: var(--disabled-text-color-btn),
      ),
    ),

    //
    outline: (
        bg: var(--bg-color-btn-outline),
        label: var(--success-text-color-btn-outline),
        hover: (
          bg: var(--success-hover-bg-color-btn-outline),
          label: var(--success-hover-text-color-btn-outline),
        ),
        active: (
          bg: var(--success-active-bg-color-btn-outline),
          label: var(--success-active-text-color-btn-outline),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    //
    ghost: (
        bg: var(--success-bg-color-btn-ghost),
        label: var(--success-text-color-btn-ghost),
        hover: (
          bg: var(--success-hover-bg-color-btn-ghost),
          label: var(--success-hover-text-color-btn-ghost),
        ),
        active: (
          bg: var(--success-active-bg-color-btn-ghost),
          label: var(--success-active-text-color-btn-ghost),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    link: (
      bg: transparent,
      label: #28a745,
      hover: (
        bg: rgba(40, 167, 69, 0.1),
        label: #218838,
      ),
      active: (
        bg: rgba(40, 167, 69, 0.2),
        label: #1e7e34,
      ),
      disabled: (
        bg: transparent,
        label: #9e9e9e,
      ),
    ),
  ),

  warning: (
    solid: (
      bg: var(--warning-bg-color-btn-solid),
      label: var(--warning-text-color-btn-solid),
      hover: (
        bg: var(--warning-hover-bg-color-btn-solid),
        label: var(--warning-hover-text-color-btn-solid),
      ),
      active: (
        bg: var(--warning-active-bg-color-btn-solid),
        label: var(--warning-active-text-color-btn-solid),
      ),
      disabled: (
        bg: var(--disabled-bg-color-btn),
        label: var(--disabled-text-color-btn),
      ),
    ),

    //
    outline: (
        bg: var(--bg-color-btn-outline),
        label: var(--warning-text-color-btn-outline),
        hover: (
          bg: var(--warning-hover-bg-color-btn-outline),
          label: var(--warning-hover-text-color-btn-outline),
        ),
        active: (
          bg: var(--warning-active-bg-color-btn-outline),
          label: var(--warning-active-text-color-btn-outline),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    //
    ghost: (
        bg: var(--warning-bg-color-btn-ghost),
        label: var(--warning-text-color-btn-ghost),
        hover: (
          bg: var(--warning-hover-bg-color-btn-ghost),
          label: var(--warning-hover-text-color-btn-ghost),
        ),
        active: (
          bg: var(--warning-active-bg-color-btn-ghost),
          label: var(--warning-active-text-color-btn-ghost),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    link: (
      bg: transparent,
      label: #ff9800,
      hover: (
        bg: rgba(255, 152, 0, 0.1),
        label: #e68a00,
      ),
      active: (
        bg: rgba(255, 152, 0, 0.2),
        label: #cc7a00,
      ),
      disabled: (
        bg: transparent,
        label: #9e9e9e,
      ),
    ),
  ),

  danger: (
    solid: (
      bg: var(--danger-bg-color-btn-solid),
      label: var(--danger-text-color-btn-solid),
      hover: (
        bg: var(--danger-hover-bg-color-btn-solid),
        label: var(--danger-hover-text-color-btn-solid),
      ),
      active: (
        bg: var(--danger-active-bg-color-btn-solid),
        label: var(--danger-active-text-color-btn-solid),
      ),
      disabled: (
        bg: var(--disabled-bg-color-btn),
        label: var(--disabled-text-color-btn),
      ),
    ),

    //
    outline: (
        bg: var(--bg-color-btn-outline),
        label: var(--danger-text-color-btn-outline),
        hover: (
          bg: var(--danger-hover-bg-color-btn-outline),
          label: var(--danger-hover-text-color-btn-outline),
        ),
        active: (
          bg: var(--danger-active-bg-color-btn-outline),
          label: var(--danger-active-text-color-btn-outline),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    //
    ghost: (
        bg: var(--danger-bg-color-btn-ghost),
        label: var(--danger-text-color-btn-ghost),
        hover: (
          bg: var(--danger-hover-bg-color-btn-ghost),
          label: var(--danger-hover-text-color-btn-ghost),
        ),
        active: (
          bg: var(--danger-active-bg-color-btn-ghost),
          label: var(--danger-active-text-color-btn-ghost),
        ),
        disabled: (
          bg: var(--disabled-bg-color-btn),
          label: var(--disabled-text-color-btn),
        ),
      ),

    link: (
      bg: transparent,
      label: #d32f2f,
      hover: (
        bg: rgba(211, 47, 47, 0.1),
        label: #b72a2a,
      ),
      active: (
        bg: rgba(211, 47, 47, 0.2),
        label: #9e2424,
      ),
      disabled: (
        bg: transparent,
        label: #9e9e9e,
      ),
    ),
  ),
);

// button size
$btn-sizes: (
  xs: (
    height: (
      pc: rem(28px),
      tablet: rem(28px),
      mobile: rem(28px),
    ),
    gap: rem(4px),
    font-token: var(--project-typo-btn1-600),
    padding: (
      pc: 0 rem(8px),
      tablet: 0 rem(8px),
      mobile: 0 rem(8px),
    ),
    radius: (
      pc: rem(6px),
      tablet: rem(6px),
      mobile: rem(6px),
    ),
    icon-size: (
      pc: rem(16px),
      tablet: rem(16px),
      mobile: rem(16px),
    ),
  ),

  sm: (
    height: (
      pc: rem(32px),
      tablet: rem(32px),
      mobile: rem(32px),
    ),
    gap: rem(4px),
    font-token: var(--project-typo-btn2-600),
    padding: (
      pc: 0 rem(12px),
      tablet: 0 rem(12px),
      mobile: 0 rem(12px),
    ),
    radius: (
      pc: rem(6px),
      tablet: rem(6px),
      mobile: rem(6px),
    ),
    icon-size: (
      pc: rem(18px),
      tablet: rem(18px),
      mobile: rem(18px),
    ),
  ),

  md: (
    height: (
      pc: rem(44px),
      tablet: rem(44px),
      mobile: rem(44px),
    ),
    gap: rem(6px),
    font-token: var(--project-typo-btn3-600),
    padding: (
      pc: 0 rem(16px),
      tablet: 0 rem(16px),
      mobile: 0 rem(16px),
    ),
    radius: (
      pc: rem(6px),
      tablet: rem(6px),
      mobile: rem(6px),
    ),
    icon-size: (
      pc: rem(20px),
      tablet: rem(20px),
      mobile: rem(20px),
    ),
  ),

  lg: (
    height: (
      pc: rem(48px),
      tablet: rem(48px),
      mobile: rem(48px),
    ),
    gap: rem(6px),
    font-token: var(--project-typo-btn4-700),
    padding: (
      pc: 0 rem(20px),
      tablet: 0 rem(20px),
      mobile: 0 rem(20px),
    ),
    radius: (
      pc: rem(8px),
      tablet: rem(8px),
      mobile: rem(8px),
    ),
    icon-size: (
      pc: rem(24px),
      tablet: rem(24px),
      mobile: rem(24px),
    ),
  ),

  xl: (
    height: (
      pc: rem(56px),
      tablet: rem(56px),
      mobile: rem(56px),
    ),
    gap: rem(8px),
    font-token: var(--project-typo-btn5-700),
    padding: (
      pc: 0 rem(24px),
      tablet: 0 rem(24px),
      mobile: 0 rem(24px),
    ),
    radius: (
      pc: rem(8px),
      tablet: rem(8px),
      mobile: rem(8px),
    ),
    icon-size: (
      pc: rem(30px),
      tablet: rem(30px),
      mobile: rem(30px),
    ),
  ),
);

// mixin - btn variant (color + shape)
@mixin btn-variant($variant) {
  &:global(.variant--#{$variant}) {
    @each $name, $props in $btn-colors {
      $variant-props: map.get($props, $variant);

      @if $variant-props != null {
        &:global(.color--#{$name}) {
          // 기본 색상
          @if $variant == 'link' {
            text-decoration: underline;
            text-underline-offset: rem(4px);
            background-color: transparent;
            color: map.get($variant-props, label);
            border: none;

            // link 타입 예외 스타일
            padding: 0 rem(8px);
          } @else {
            background-color: map.get($variant-props, bg);
            color: map.get($variant-props, label);

            @if $variant == 'outline' {
              border-width: rem(1px);
              border-style: solid;
              border-color: currentColor;
            } @else if $variant == 'soft' or $variant == 'ghost' {
              border: none;
            } @else {
              border: none;
            }
          }

          // hover 처리
          &:hover:not([aria-disabled='true']):not(:disabled) {
            $hover-props: map.get($variant-props, hover);
            @if $hover-props != null {
              @if $variant == 'link' {
                background-color: map.get($hover-props, bg);
              } @else {
                background-color: map.get($hover-props, bg);
                color: map.get($hover-props, label);
              }
            }
          }

          // active 처리
          &:active:not([aria-disabled='true']):not(:disabled) {
            $active-props: map.get($variant-props, active);
            @if $active-props != null {
              @if $variant == 'link' {
                background-color: map.get($active-props, bg);
              } @else {
                background-color: map.get($active-props, bg);
                color: map.get($active-props, label);
              }
            }
            transform: scale(0.97);
          }

          // disabled 처리
          &[aria-disabled='true'],
          &:disabled {
            cursor: not-allowed;
            user-select: none;
            $disabled-props: map.get($variant-props, disabled);

            @if $disabled-props != null {
              @if $variant == 'link' {
                color: map.get($disabled-props, label);
                background-color: map.get($disabled-props, bg);
              } @else {
                background-color: map.get($disabled-props, bg);
                color: map.get($disabled-props, label);

                @if $variant == 'outline' {
                }
              }
            } @else {
            }
          }
        }
      } @else {
        @warn "Variant '#{$variant}' not found for button '#{$name}'";
      }
    }
  }
}

// mixin - btn sizes
@mixin btn-size() {
  @each $size-name, $props in $btn-sizes {
    // ──────────────── 기본 데이터 추출 ────────────────
    $padding: map.get($props, padding);
    $icon-size: map.get($props, icon-size);
    $height-map: map.get($props, height);

    $height-pc: map.get($height-map, pc);
    $height-tablet: map.get($height-map, tablet);
    $height-mobile: map.get($height-map, mobile);

    // ──────────────── PC 스타일 ────────────────
    &:global(.size--#{$size-name}) {
      height: $height-pc;
      padding: map.get($padding, pc);
      gap: map.get($props, gap);

      :global(div[class^='_spinner']),
      :global(.icon) {
        flex: 0 0 auto;
        width: map.get($icon-size, pc);
        height: map.get($icon-size, pc);
      }

      .btn-label {
        width: max-content;
        flex: 1 1 auto;
        min-width: 0;
        font: map.get($props, font-token);
        @include ell();
      }
    }

    // ──────────────── Tablet 스타일 (max-width: 768px) ────────────────
    @media (max-width: 768px) {
      &:global(.size--#{$size-name}) {
        height: $height-tablet;
        padding: map.get($padding, tablet);

        svg {
          width: map.get($icon-size, tablet);
          height: map.get($icon-size, tablet);
        }
      }
    }

    // ──────────────── Mobile 스타일 (max-width: 480px) ────────────────
    @media (max-width: 480px) {
      &:global(.size--#{$size-name}) {
        height: $height-mobile; // 모바일 최소 44px 이미 map에서 보정됨
        padding: map.get($padding, mobile);

        svg {
          width: map.get($icon-size, mobile);
          height: map.get($icon-size, mobile);
        }
      }
    }
  }
}

// mixins - btn radius
@mixin btn-radius($btn-sizes) {
  &:global(.shape--rounded) {
    @each $size-name, $props in $btn-sizes {
      $radius: map.get($props, radius);

      &:global(.size--#{$size-name}) {
        // PC 기본값
        border-radius: map.get($radius, pc);

        // Tablet 이하
        @media (max-width: 768px) {
          border-radius: map.get($radius, tablet);
        }

        // Mobile 이하
        @media (max-width: 480px) {
          border-radius: map.get($radius, mobile);
        }
      }
    }
  }
}

.btn {
  min-width: rem(44px);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  transition: all 0.2s ease;
  cursor: pointer;
  user-select: none;

  &:global(.is-full) {
    width: 100%;
  }

  // size
  @include btn-size();

  // variant
  @include btn-variant(solid);
  @include btn-variant(outline);
  @include btn-variant(ghost);
  @include btn-variant(link);

  // shape
  &:global(.shape--square) {
    border-radius: 0;
  }
  &:global(.shape--rounded) {
    // radius
    @include btn-radius($btn-sizes);
  }
  &:global(.shape--pill) {
    border-radius: var(--project-border-radius-max);
  }
}
