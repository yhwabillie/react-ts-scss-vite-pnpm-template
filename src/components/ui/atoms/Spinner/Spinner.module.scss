/* Spinner.module.scss */
@use 'sass:map';
@use 'sass:meta';
@use '../../../../styles/mixins' as *;

// 인접 배경과 경로 간 명도대비, 경로와 식별자 간 명도대비를 3:1 이상으로 표현한다.
// 시력이 좋지 않은 사용자도 스피너의 출현 여부와 진행 상태를 인지할 수 있도록 인접 배경과 경로 간 명도대비, 경로와 식별자 간 명도대비를 3:1 이상으로 제공
// 스피너 상태에 대한 설명을 스크린 리더에서 확인할 수 있도록 한다.
// 스크린 리더 사용자가 스피너를 통해 제공되는 페이지 로딩 상태 정보를 확인할 수 있도록 스피너가 제공되기 시작했을 때와 로딩이 완료되었을 때의 상태 정보를 제공해야 한다.
// 페이지의 핵심 정보에 대한 음성 안내 방해를 최소화하도록 aria-live 속성값은 assertive가 아닌 polite를 사용해야 한다.

// 확정 스피너
// 식별자가 도넛형 경로의 0도에서부터 360도까지 채워지면서 진행 정도를 표시한다. 식별자가 채워진 정도는 실제 진행률을 반영해야 하며, 360도 전체가 채워지면 스피너를 숨기고 페이지를 표시한다. 식별자는 0도에서 운동을 시작하여 시계 방향으로 경로를 채운다.

// 불확정 스피너
// 식별자가 도넛형 경로의 0도에서부터 360도를 따라 회전하면서 대기 상태에 있음을 표시한다. 페이지가 표시되기 전까지 식별자의 회전 운동은 반복되어야 한다. 식별자는 0도에서 운동을 시작하여 시계 방향으로 회전한다.

// Spinner Colors
$spinner-colors: (
  // Primary
  primary: (
      open-ring: (
        track: var(--primary-track-color-spinner-open-ring),
        path: var(--primary-path-color-spinner-open-ring),
      ),
      closed-ring: (
        track: var(--primary-track-color-spinner-closed-ring),
        path: var(--primary-path-color-spinner-closed-ring),
      ),
    ),
  primary-solid: (
    open-ring: (
      track: var(--primary-solid-track-color-spinner-open-ring),
      path: var(--primary-solid-path-color-spinner-open-ring),
    ),
    closed-ring: (
      track: var(--primary-solid-track-color-spinner-closed-ring),
      path: var(--primary-solid-path-color-spinner-closed-ring),
    ),
  ),

  // Secondary
  secondary: (
      open-ring: (
        track: var(--secondary-track-color-spinner-open-ring),
        path: var(--secondary-path-color-spinner-open-ring),
      ),
      closed-ring: (
        track: var(--secondary-track-color-spinner-closed-ring),
        path: var(--secondary-path-color-spinner-closed-ring),
      ),
    ),
  secondary-solid: (
    open-ring: (
      track: var(--secondary-solid-track-color-spinner-open-ring),
      path: var(--secondary-solid-path-color-spinner-open-ring),
    ),
    closed-ring: (
      track: var(--secondary-solid-track-color-spinner-closed-ring),
      path: var(--secondary-solid-path-color-spinner-closed-ring),
    ),
  ),

  // Tertiary
  tertiary: (
      open-ring: (
        track: var(--tertiary-track-color-spinner-open-ring),
        path: var(--tertiary-path-color-spinner-open-ring),
      ),
      closed-ring: (
        track: var(--tertiary-track-color-spinner-closed-ring),
        path: var(--tertiary-path-color-spinner-closed-ring),
      ),
    ),
  tertiary-solid: (
    open-ring: (
      track: var(--tertiary-solid-track-color-spinner-open-ring),
      path: var(--tertiary-solid-path-color-spinner-open-ring),
    ),
    closed-ring: (
      track: var(--tertiary-solid-track-color-spinner-closed-ring),
      path: var(--tertiary-solid-path-color-spinner-closed-ring),
    ),
  )
);

// Spinner Size
$spinner-sizes: (
  xs: (
    size: (
      pc: rem(12px),
      // 버튼 height 28px → spinner 12px
      tablet: rem(12px),
      mobile: rem(12px),
    ),
  ),
  sm: (
    size: (
      pc: rem(14px),
      // 버튼 height 32px → spinner 16px
      tablet: rem(14px),
      mobile: rem(14px),
    ),
  ),
  md: (
    size: (
      pc: rem(16px),
      // 버튼 height 40px → spinner 20px
      tablet: rem(16px),
      mobile: rem(16px),
    ),
  ),
  lg: (
    size: (
      pc: rem(20px),
      // 버튼 height 48px → spinner 24px
      tablet: rem(20px),
      mobile: rem(20px),
    ),
  ),
  xl: (
    size: (
      pc: rem(24px),
      // 버튼 height 56px → spinner 28px
      tablet: rem(24px),
      mobile: rem(24px),
    ),
  ),
);

@keyframes rotate {
  100% {
    transform: rotate(360deg);
  }
}

// mixin - spinner sizes
@mixin spinner-size() {
  @each $size-name, $props in $spinner-sizes {
    // ──────────────── 기본 데이터 추출 ────────────────
    $size-map: map.get($props, size);

    $size-pc: map.get($size-map, pc);
    $size-tablet: map.get($size-map, tablet);
    $size-mobile: map.get($size-map, mobile);

    // ──────────────── PC 스타일 ────────────────
    &:global(.size--#{$size-name}) {
      width: $size-pc;
      height: $size-pc;
    }

    // ──────────────── Tablet 스타일 (max-width: 768px) ────────────────
    @media (max-width: 768px) {
      &:global(.size--#{$size-name}) {
        width: $size-tablet;
        height: $size-tablet;
      }
    }

    // ──────────────── Mobile 스타일 (max-width: 480px) ────────────────
    @media (max-width: 480px) {
      &:global(.size--#{$size-name}) {
        width: $size-mobile;
        height: $size-mobile;
      }
    }
  }
}

// mixin - spinner variant (color + shape)
@mixin spinner-variant($variant) {
  &:global(.variant--#{$variant}) {
    @each $name, $props in $spinner-colors {
      $variant-props: map.get($props, $variant);

      //   @debug '#{meta.inspect($variant)}';

      @if $variant-props != null {
        &:global(.color--#{$name}) {
          @if $variant == 'open-ring' {
            svg {
              :global(.track) {
                stroke: map.get($variant-props, track);
              }

              :global(.path) {
                stroke: map.get($variant-props, path);
              }
            }
          } @else if $variant == 'closed-ring' {
            svg {
              :global(.track) {
                stroke: map.get($variant-props, track);
              }

              :global(.path) {
                stroke: map.get($variant-props, path);
              }
            }
          }
        }
      } @else {
        @warn "Variant '#{$variant}' not found for spinner '#{$name}'";
      }
    }
  }
}

.spinner {
  display: inline-flex;
  align-items: center;
  justify-content: center;

  svg {
    width: 100%;
    height: 100%;
    transform-origin: center;
    animation: rotate 1s linear infinite;

    :global(.track) {
      fill: none;
      stroke-width: 5;
    }

    :global(.path) {
      fill: none;
      stroke-width: 5;
      stroke-linecap: round;
      stroke-dasharray: 80 40;
      stroke-dashoffset: 0;
    }
  }

  // size
  @include spinner-size();

  // variant
  @include spinner-variant(closed-ring);
  @include spinner-variant(open-ring);
}
