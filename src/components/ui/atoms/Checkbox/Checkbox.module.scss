/* Checkbox.module.scss */
@use 'sass:map';
@use 'sass:meta';
@use '../../../../styles/mixins' as *;

// checkbox color
$checkbox-colors: (
  primary: (
    borderColor: var(--project-color-checkbox-border),
    bg: var(--project-color-checkbox-unchecked-bg),
    fill: var(--primary-checked-color-checkbox),
    hover: (
      shadow: 0 0 0 rem(4px) var(--primary-hover-shadow-checkbox),
    ),
    active: (
      shadow: 0 0 0 rem(6px) var(--primary-active-shadow-checkbox),
    ),
    disabled: (
      bg: var(--disabled-bg-color-checkbox),
      border: var(--disabled-stroke-color-checkbox),
    ),
  ),
  secondary: (
    borderColor: var(--project-color-checkbox-border),
    bg: var(--project-color-checkbox-unchecked-bg),
    fill: var(--secondary-checked-color-checkbox),
    hover: (
      shadow: 0 0 0 rem(4px) var(--secondary-hover-shadow-checkbox),
    ),
    active: (
      shadow: 0 0 0 rem(6px) var(--secondary-active-shadow-checkbox),
    ),
    disabled: (
      bg: var(--disabled-bg-color-checkbox),
      border: var(--disabled-stroke-color-checkbox),
    ),
  ),
  tertiary: (
    borderColor: var(--project-color-checkbox-border),
    bg: var(--project-color-checkbox-unchecked-bg),
    fill: var(--tertiary-checked-color-checkbox),
    hover: (
      shadow: 0 0 0 rem(4px) var(--tertiary-hover-shadow-checkbox),
    ),
    active: (
      shadow: 0 0 0 rem(6px) var(--tertiary-active-shadow-checkbox),
    ),
    disabled: (
      bg: var(--disabled-bg-color-checkbox),
      border: var(--disabled-stroke-color-checkbox),
    ),
  ),
  success: (
    borderColor: var(--project-color-checkbox-border),
    bg: var(--project-color-checkbox-unchecked-bg),
    fill: var(--success-checked-color-checkbox),
    hover: (
      shadow: 0 0 0 rem(4px) var(--success-hover-shadow-checkbox),
    ),
    active: (
      shadow: 0 0 0 rem(6px) var(--success-active-shadow-checkbox),
    ),
    disabled: (
      bg: var(--disabled-bg-color-checkbox),
      border: var(--disabled-stroke-color-checkbox),
    ),
  ),
  warning: (
    borderColor: var(--project-color-checkbox-border),
    bg: var(--project-color-checkbox-unchecked-bg),
    fill: var(--warning-checked-color-checkbox),
    hover: (
      shadow: 0 0 0 rem(4px) var(--warning-hover-shadow-checkbox),
    ),
    active: (
      shadow: 0 0 0 rem(6px) var(--warning-active-shadow-checkbox),
    ),
    disabled: (
      bg: var(--disabled-bg-color-checkbox),
      border: var(--disabled-stroke-color-checkbox),
    ),
  ),
  danger: (
    borderColor: var(--project-color-checkbox-border),
    bg: var(--project-color-checkbox-unchecked-bg),
    fill: var(--danger-checked-color-checkbox),
    hover: (
      shadow: 0 0 0 rem(4px) var(--danger-hover-shadow-checkbox),
    ),
    active: (
      shadow: 0 0 0 rem(6px) var(--danger-active-shadow-checkbox),
    ),
    disabled: (
      bg: var(--disabled-bg-color-checkbox),
      border: var(--disabled-stroke-color-checkbox),
    ),
  ),
);

// checkbox size
$checkbox-sizes: (
  xs: (
    size: (
      pc: rem(12px),
      tablet: rem(12px),
      mobile: rem(44px),
    ),
    radius: (
      pc: rem(2px),
      tablet: rem(2px),
      mobile: rem(6px),
      // 44px 터치 영역 대비 자연스러운 반경
    ),
  ),
  sm: (
    size: (
      pc: rem(16px),
      tablet: rem(16px),
      mobile: rem(44px),
    ),
    radius: (
      pc: rem(2px),
      tablet: rem(2px),
      mobile: rem(6px),
    ),
  ),
  md: (
    size: (
      pc: rem(20px),
      tablet: rem(20px),
      mobile: rem(44px),
    ),
    radius: (
      pc: rem(3px),
      tablet: rem(3px),
      mobile: rem(7px),
    ),
  ),
  lg: (
    size: (
      pc: rem(24px),
      tablet: rem(24px),
      mobile: rem(44px),
    ),
    radius: (
      pc: rem(4px),
      tablet: rem(4px),
      mobile: rem(8px),
    ),
  ),
  xl: (
    size: (
      pc: rem(28px),
      tablet: rem(28px),
      mobile: rem(44px),
    ),
    radius: (
      pc: rem(5px),
      tablet: rem(5px),
      mobile: rem(8px),
    ),
  ),
);

// mixin - checkbox color
@mixin checkbox-color($color) {
  $props: map.get($checkbox-colors, $color);
  $fill: map.get($props, fill);
  $border-color: map.get($props, borderColor);
  $bg: map.get($props, bg);
  $hover-map: map.get($props, hover);
  $active-map: map.get($props, active);

  // shadow
  $hover-shadow: map.get($hover-map, shadow);
  $active-shadow: map.get($active-map, shadow);

  // disabled 색상
  $disabled-props: map.get($props, disabled);
  $disabled-bg: map.get($disabled-props, bg);
  $disabled-border: map.get($disabled-props, border);

  border: rem(1px) solid $border-color;

  &:global(.color--#{$color}) {
    background-color: $bg;
    transition: all 0.2s ease;

    &:has(input:checked) {
      border-color: $fill;
    }

    &:hover {
      box-shadow: $hover-shadow;
    }

    &:active {
      box-shadow: $active-shadow;
    }

    &:has(input:disabled) {
      cursor: not-allowed;
      pointer-events: none;
      user-select: none;
      border-color: $disabled-border;
    }

    input:checked + :global(.mark) {
      background-color: $fill;
    }

    input:disabled + :global(.mark) {
      color: $disabled-border;
      background-color: $disabled-bg;
    }
  }
}

// mixin - checkbox sizes
@mixin checkbox-size() {
  @each $size-name, $props in $checkbox-sizes {
    // ──────────────── 기본 데이터 추출 ────────────────
    $size-map: map.get($props, size);
    $radius-map: map.get($props, radius);

    $size-pc: map.get($size-map, pc);
    $size-tablet: map.get($size-map, tablet);
    $size-mobile: map.get($size-map, mobile);

    $radius-pc: map.get($radius-map, pc);
    $radius-tablet: map.get($radius-map, tablet);
    $radius-mobile: map.get($radius-map, mobile);

    // ──────────────── PC 스타일 ────────────────
    &:global(.size--#{$size-name}) {
      width: $size-pc;
      height: $size-pc;
      border-radius: $radius-pc;
    }

    // ──────────────── Tablet 스타일 (max-width: 768px) ────────────────
    @media (max-width: 768px) {
      &:global(.size--#{$size-name}) {
        width: $size-tablet;
        height: $size-tablet;
        border-radius: $radius-tablet;
      }
    }

    // ──────────────── Mobile 스타일 (max-width: 480px) ────────────────
    @media (max-width: 480px) {
      &:global(.size--#{$size-name}) {
        width: $size-mobile;
        height: $size-mobile;
        border-radius: $radius-mobile;
      }
    }
  }
}

.checkbox {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  overflow: hidden;
  position: relative;
  flex: 0 0 auto;

  // size
  @include checkbox-size();

  // color
  @include checkbox-color(primary);
  @include checkbox-color(secondary);
  @include checkbox-color(tertiary);
  @include checkbox-color(success);
  @include checkbox-color(warning);
  @include checkbox-color(danger);

  input[type='checkbox'] {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;

    &:checked ~ :global(.mark) {
      path {
        stroke-opacity: 1;
        stroke-dashoffset: 0;
      }
    }
  }

  :global(.mark) {
    color: #ffffff;

    path {
      stroke-opacity: 0;
      stroke-dasharray: 12;
      stroke-dashoffset: 12;
      transition:
        stroke-dashoffset 0.1s ease-out 0.15s,
        // dash offset은 delay
        stroke-opacity 0.01s ease-in 0.15s; // opacity는 dashoffset 시작 직전에 켬
    }
  }
}
